<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Canh giờ Boss - Lineage2M</title>
  <style>
    body { font-family: Arial, sans-serif; padding: 20px; }
    table { width: 100%; border-collapse: collapse; margin-top: 20px; }
    th, td { padding: 8px; border: 1px solid #ccc; text-align: center; }
    input[type="datetime-local"] { width: 100%; }
    button { padding: 5px 10px; }
  </style>
</head>
<body>
  <h1>Canh giờ Boss - Lineage2M</h1>
  <table id="bossTable">
    <thead>
      <tr>
        <th>Zone</th>
        <th>Location</th>
        <th>Name</th>
        <th>Level</th>
        <th>Respawn</th>
        <th>Kill Time</th>
        <th>Nhập</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>

  <script>
    const sheetUrl = "https://script.google.com/macros/s/AKfycbyo7xVyR5OVsZAx0TB4Ta-H2t-KuNJ7sn1DMqXfJKXN3cqHdngx0MMhYqBnqGHvMcyM/exec";

    async function fetchBossList() {
      try {
        const res = await fetch(sheetUrl);
        const data = await res.json();
        const tbody = document.querySelector("#bossTable tbody");
        tbody.innerHTML = "";

        data.forEach(boss => {
          const row = document.createElement("tr");
          row.innerHTML = `
            <td>${boss.zone}</td>
            <td>${boss.location}</td>
            <td>${boss.name}</td>
            <td>${boss.level}</td>
            <td>${boss.respawn}</td>
            <td><input type="datetime-local" id="kill-${boss.name}"></td>
            <td><button onclick="submitKillTime('${boss.name}', '${boss.zone}', '${boss.location}')">Gửi</button></td>
          `;
          tbody.appendChild(row);
        });
      } catch (e) {
        alert("Lỗi tải dữ liệu từ Google Sheet.");
        console.error(e);
      }
    }

    async function submitKillTime(name, zone, location) {
      const input = document.querySelector(`#kill-${name}`);
      const killTime = input.value;
      if (!killTime) return alert("Vui lòng chọn thời gian kill.");

      const payload = { name, zone, location, killTime };

      try {
        const res = await fetch(sheetUrl, {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify(payload)
        });

        const text = await res.text();
        alert("Đã gửi thời gian kill boss thành công!");
        console.log("Phản hồi:", text);
      } catch (err) {
        alert("Lỗi khi gửi dữ liệu!");
        console.error(err);
      }
    }

    fetchBossList();
  </script>
</body>
</html>
